<script async="async" data-cfasync="false" src="//pl25816526.effectiveratecpm.com/e506d87dfb31714e2850824605734f81/invoke.js"></script>
<div id="container-e506d87dfb31714e2850824605734f81"></div>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Weather App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #0083b0;
            --secondary-color: #00b4db;
            --text-color-primary: #333;
            --text-color-secondary: #666;
            --bg-light: rgba(255, 255, 255, 0.9);
            --bg-light-hover: rgba(255, 255, 255, 0.7);
            --box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --border-radius: 15px;
            --transition: all 0.3s ease-in-out;
            font-size: 16px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin-top: 2rem;
        }

        .button-container {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .weather-card, .forecast-section, .hourly-section {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: none;
        }

        .location-info {
            font-size: 1.2rem;
            color: var(--text-color-secondary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .weather-icon {
            font-size: 4rem;
            margin: 1rem 0;
            text-align: center;
            color: var(--primary-color);
        }

        .temperature {
            font-size: 3rem;
            font-weight: bold;
            color: var(--text-color-primary);
            text-align: center;
        }

        .weather-description {
            text-align: center;
            color: var(--text-color-secondary);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .detail-card {
            background: var(--bg-light-hover);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .detail-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .forecast-title, .hourly-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--text-color-primary);
            font-size: 1.5rem;
            font-weight: bold;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .forecast-day {
            background: var(--bg-light-hover);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .forecast-day:hover {
            transform: translateY(-5px);
        }

        .forecast-date {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .forecast-icon {
            font-size: 2rem;
            margin: 0.5rem 0;
            color: var(--primary-color);
        }

        .forecast-temp {
            display: flex;
            justify-content: space-around;
            margin-top: 0.5rem;
        }

        .forecast-temp span {
            font-size: 1rem;
        }

        .forecast-details {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-color-secondary);
        }

        .hourly-container {
            display: flex;
            overflow-x: auto;
            padding: 0.5rem 0;
            gap: 1rem;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f0f0f0;
        }

        .hourly-container::-webkit-scrollbar {
            height: 8px;
        }

        .hourly-container::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .hourly-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .hourly-item {
            min-width: 100px;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-light-hover);
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .hourly-item:hover {
            transform: translateY(-5px);
        }

        .hourly-time {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .hourly-icon {
            font-size: 1.5rem;
            margin: 0.25rem 0;
            color: var(--primary-color);
        }

        .hourly-temp {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .hourly-details {
            font-size: 0.8rem;
            color: var(--text-color-secondary);
            margin-top: 0.25rem;
        }

        .temperature-graph {
            width: 100%;
            height: 200px;
            margin: 1rem 0;
            position: relative;
            background: var(--bg-light-hover);
            border-radius: 10px;
            padding: 1rem;
        }
        .axis-label {
            font-size: 0.8rem;
            fill: var(--text-color-secondary);
        }
        .axis line {
            stroke: var(--text-color-secondary);
            stroke-width: 1;
        }
        .axis path {
            stroke: var(--text-color-secondary);
            stroke-width: 1;
        }
        .axis text {
            fill: var(--text-color-secondary);
            font-size: 0.7rem;
        }
        .temperature-line {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .temperature-point {
            fill: white;
            stroke-width: 2;
            transition: all 0.3s ease;
        }
        .temperature-point:hover {
            transform: scale(1.5);
        }
        .tooltip {
            position: absolute;
            background: var(--bg-light);
            padding: 0.5rem;
            border-radius: 5px;
            box-shadow: var(--box-shadow);
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            :root {
                font-size: 14px;
            }
            .weather-details {
                grid-template-columns: 1fr;
            }
            .forecast-container {
                grid-template-columns: 1fr;
            }
            .hourly-item {
                min-width: 80px;
            }
        }

        @media (max-width: 576px) {
            .button-container {
                flex-direction: column;
                align-items: stretch;
            }
            .btn-primary {
                width: 100%;
            }
        }

        .hourly-section {
            margin: 1.5rem 0;
            background: var(--bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
        }
        .hourly-timeline {
            display: flex;
            overflow-x: auto;
            padding: 1rem 0;
            gap: 1rem;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f0f0f0;
            position: relative;
        }
        .hourly-timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            z-index: 1;
        }
        .hourly-item {
            min-width: 120px;
            background: var(--bg-light-hover);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            position: relative;
            z-index: 2;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        .hourly-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }
        .hourly-time {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        .hourly-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin: 0.5rem 0;
        }
        .hourly-temp {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color-primary);
            position: relative;
            padding: 0.5rem 0;
        }
        .hourly-temp::after {
            content: '°C';
            font-size: 0.8rem;
            position: absolute;
            top: 0;
            right: -1rem;
        }
        .hourly-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
        }
        .hourly-detail-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-color-secondary);
        }
        .hourly-detail-icon {
            color: var(--primary-color);
            font-size: 1rem;
        }
        .hourly-weather-desc {
            font-size: 0.8rem;
            color: var(--text-color-secondary);
            font-style: italic;
            margin-top: 0.5rem;
        }
        .hourly-feels-like {
            font-size: 0.9rem;
            color: var(--text-color-secondary);
        }
        .hourly-feels-like::before {
            content: 'Feels like: ';
            font-size: 0.8rem;
        }
        .hourly-feels-like::after {
            content: '°C';
            font-size: 0.8rem;
        }
        @media (max-width: 768px) {
            .hourly-item {
                min-width: 100px;
            }
            .hourly-time {
                font-size: 1rem;
            }
            .hourly-icon {
                font-size: 1.5rem;
            }
            .hourly-temp {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="button-container">
            <button type="button" class="btn btn-primary" id="get-location-button">
                <i class="fas fa-map-marker-alt"></i> Get My Location
            </button>
            <button type="button" class="btn btn-primary" id="get-weather-button" style="display: none;">
                <i class="fas fa-cloud-sun"></i> Get Weather
            </button>
        </div>

        <div class="weather-card" id="weather-card">
            <div class="location-info" id="location"></div>
            <div class="weather-icon" id="weather-icon"></div>
            <div class="temperature" id="temperature"></div>
            <div class="weather-description" id="weather-description"></div>

            <div class="weather-details">
                <div class="detail-card">
                    <div class="detail-icon"><i class="fas fa-thermometer-half"></i></div>
                    <div>Feels Like</div>
                    <div id="feels-like"></div>
                </div>
                <div class="detail-card">
                    <div class="detail-icon"><i class="fas fa-tint"></i></div>
                    <div>Humidity</div>
                    <div id="humidity"></div>
                </div>
                <div class="detail-card">
                    <div class="detail-icon"><i class="fas fa-wind"></i></div>
                    <div>Wind Speed</div>
                    <div id="wind-speed"></div>
                </div>
                <div class="detail-card">
                    <div class="detail-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div>Pressure</div>
                    <div id="pressure"></div>
                </div>
            </div>
        </div>

        <div class="hourly-section" id="hourly-section" style="display: none;">
            <h2 class="hourly-title">Today's Hourly Forecast</h2>
            <div class="temperature-graph" id="temperature-graph"></div>
            <div class="hourly-container" id="hourly-container"></div>
        </div>

        <div class="forecast-section" id="forecast-section" style="display: none;">
            <h2 class="forecast-title">7-Day Forecast</h2>
            <div class="forecast-container" id="forecast-container"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.1.1/d3.min.js"></script>
    <script>
        $(document).ready(function() {
            let location = null;
            let apiKey = 'dotevn.APIKEY';

            function getWeatherIcon(weatherCode) {
                const icons = {
                    '01d': 'fas fa-sun',
                    '01n': 'fas fa-moon',
                    '02d': 'fas fa-cloud-sun',
                    '02n': 'fas fa-cloud-moon',
                    '03d': 'fas fa-cloud',
                    '03n': 'fas fa-cloud',
                    '04d': 'fas fa-cloud',
                    '04n': 'fas fa-cloud',
                    '09d': 'fas fa-cloud-rain',
                    '09n': 'fas fa-cloud-rain',
                    '10d': 'fas fa-cloud-sun-rain',
                    '10n': 'fas fa-cloud-moon-rain',
                    '11d': 'fas fa-bolt',
                    '11n': 'fas fa-bolt',
                    '13d': 'fas fa-snowflake',
                    '13n': 'fas fa-snowflake',
                    '50d': 'fas fa-smog',
                    '50n': 'fas fa-smog'
                };
                return icons[weatherCode] || 'fas fa-cloud';
            }

            $('#get-location-button').click(function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        location = position.coords;
                        $('#get-weather-button').show();
                        $('#get-location-button').hide();
                    }, function() {
                        alert('Error getting location. Please enable location services.');
                    });
                } else {
                    alert('Geolocation is not supported by your browser.');
                }
            });

            function getDayName(date) {
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                return days[date.getDay()];
            }

            function formatDate(date) {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }

            function processForecastData(forecastData) {
                const dailyData = {};

                forecastData.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dayKey = date.toDateString();

                    if (!dailyData[dayKey]) {
                        dailyData[dayKey] = {
                            date: date,
                            temps: [],
                            humidity: [],
                            wind: [],
                            weather: item.weather[0]
                        };
                    }

                    dailyData[dayKey].temps.push(item.main.temp);
                    dailyData[dayKey].humidity.push(item.main.humidity);
                    dailyData[dayKey].wind.push(item.wind.speed);
                });

                return Object.values(dailyData).slice(0, 7);
            }

            function processHourlyData(forecastData) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                return forecastData.list.filter(item => {
                    const itemDate = new Date(item.dt * 1000);
                    return itemDate >= today && itemDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
                });
            }

            function formatHour(date) {
                return date.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
            }

            function createTemperatureGraph(hourlyData) {
                const graphContainer = d3.select("#temperature-graph");
                graphContainer.selectAll("*").remove();

                if (!hourlyData || hourlyData.length < 2) {
                    graphContainer.append("p").text("Not enough hourly data to display the graph.");
                    return;
                }

                const margin = { top: 20, right: 30, bottom: 40, left: 50 };
                const width = graphContainer.node().getBoundingClientRect().width - margin.left - margin.right;
                const height = graphContainer.node().getBoundingClientRect().height - margin.top - margin.bottom;

                const svg = graphContainer.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const temps = hourlyData.map(item => item.main.temp);
                const times = hourlyData.map(item => new Date(item.dt * 1000));

                // Create scales
                const x = d3.scaleTime()
                    .domain(d3.extent(times))
                    .range([0, width]);

                const y = d3.scaleLinear()
                    .domain([Math.min(...temps) - 2, Math.max(...temps) + 2])
                    .range([height, 0]);

                // Create color gradient based on temperature
                const colorScale = d3.scaleLinear()
                    .domain([Math.min(...temps), (Math.min(...temps) + Math.max(...temps)) / 2, Math.max(...temps)])
                    .range(["lightgreen", "orange", "red"]);

                // Create tooltip
                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

                // Create the line generator
                const line = d3.line()
                    .x(d => x(new Date(d.dt * 1000)))
                    .y(d => y(d.main.temp));

                // Add the line path with gradient color
                const path = svg.append("path")
                    .datum(hourlyData)
                    .attr("class", "temperature-line")
                    .attr("d", line)
                    .attr("stroke", "url(#temperature-gradient)")
                    .attr("stroke-width", 3);

                // Create gradient definition
                const gradient = svg.append("defs")
                    .append("linearGradient")
                    .attr("id", "temperature-gradient")
                    .attr("x1", "0%")
                    .attr("y1", "0%")
                    .attr("x2", "100%")
                    .attr("y2", "0%");

                // Add gradient stops
                hourlyData.forEach((d, i) => {
                    gradient.append("stop")
                        .attr("offset", `${(i / (hourlyData.length - 1)) * 100}%`)
                        .attr("stop-color", colorScale(d.main.temp));
                });

                // Add data points
                svg.selectAll(".temperature-point")
                    .data(hourlyData)
                    .enter()
                    .append("circle")
                    .attr("class", "temperature-point")
                    .attr("cx", d => x(new Date(d.dt * 1000)))
                    .attr("cy", d => y(d.main.temp))
                    .attr("r", 4)
                    .attr("stroke", d => colorScale(d.main.temp))
                    .on("mouseover", function(event, d) {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9);
                        tooltip.html(`Time: ${d3.timeFormat("%H:%M")(new Date(d.dt * 1000))}<br/>Temp: ${Math.round(d.main.temp)}°C`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });

                // Add X axis with 4-hour intervals
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x)
                        .ticks(d3.timeHour.every(4))
                        .tickFormat(d3.timeFormat("%H:%M")))
                    .append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", 35)
                    .attr("text-anchor", "middle")
                    .text("Time (4-hour intervals)");

                // Add Y axis
                svg.append("g")
                    .call(d3.axisLeft(y)
                        .ticks(5)
                        .tickFormat(d => `${d}°C`))
                    .append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -40)
                    .attr("x", -height / 2)
                    .attr("text-anchor", "middle")
                    .text("Temperature (°C)");
            }

            function createHourlyForecast(hourlyData) {
                const hourlyContainer = $('#hourly-container');
                hourlyContainer.empty();
                
                hourlyData.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const hourlyItem = `
                        <div class="hourly-item">
                            <div class="hourly-time">${formatHour(date)}</div>
                            <div class="hourly-icon"><i class="${getWeatherIcon(item.weather[0].icon)}"></i></div>
                            <div class="hourly-temp">${Math.round(item.main.temp)}</div>
                            <div class="hourly-feels-like">${Math.round(item.main.feels_like)}</div>
                            <div class="hourly-weather-desc">${item.weather[0].description}</div>
                            <div class="hourly-details">
                                <div class="hourly-detail-item">
                                    <i class="fas fa-tint hourly-detail-icon"></i>
                                    <span>${item.main.humidity}%</span>
                                </div>
                                <div class="hourly-detail-item">
                                    <i class="fas fa-wind hourly-detail-icon"></i>
                                    <span>${item.wind.speed.toFixed(1)} m/s</span>
                                </div>
                                <div class="hourly-detail-item">
                                    <i class="fas fa-tachometer-alt hourly-detail-icon"></i>
                                    <span>${item.main.pressure} hPa</span>
                                </div>
                            </div>
                        </div>
                    `;
                    hourlyContainer.append(hourlyItem);
                });
            }

            $('#get-weather-button').click(function() {
                if (location) {
                    $.ajax({
                        type: 'GET',
                        url: 'https://api.openweathermap.org/data/2.5/weather',
                        data: {
                            lat: location.latitude,
                            lon: location.longitude,
                            units: 'metric',
                            appid: apiKey
                        },
                        success: function(data) {
                            $('#location').html(`<i class="fas fa-map-marker-alt"></i> ${data.name}, ${data.sys.country}`);
                            $('#temperature').text(`${Math.round(data.main.temp)}°C`);
                            $('#weather-icon').html(`<i class="${getWeatherIcon(data.weather[0].icon)}"></i>`);
                            $('#weather-description').text(data.weather[0].description);
                            $('#feels-like').text(`${Math.round(data.main.feels_like)}°C`);
                            $('#humidity').text(`${data.main.humidity}%`);
                            $('#wind-speed').text(`${data.wind.speed} m/s`);
                            $('#pressure').text(`${data.main.pressure} hPa`);

                            $('#weather-card').fadeIn();

                            $.ajax({
                                type: 'GET',
                                url: 'https://api.openweathermap.org/data/2.5/forecast',
                                data: {
                                    lat: location.latitude,
                                    lon: location.longitude,
                                    units: 'metric',
                                    appid: apiKey
                                },
                                success: function(forecastData) {
                                    const hourlyData = processHourlyData(forecastData);
                                    createHourlyForecast(hourlyData);
                                    
                                    createTemperatureGraph(hourlyData);
                                    
                                    $('#hourly-section').fadeIn();
                                    
                                    const dailyForecast = processForecastData(forecastData);
                                    const forecastContainer = $('#forecast-container');
                                    forecastContainer.empty();

                                    dailyForecast.forEach(day => {
                                        const minTemp = Math.round(Math.min(...day.temps));
                                        const maxTemp = Math.round(Math.max(...day.temps));
                                        const avgHumidity = Math.round(day.humidity.reduce((a, b) => a + b) / day.humidity.length);
                                        const avgWind = (day.wind.reduce((a, b) => a + b) / day.wind.length).toFixed(1);

                                        const forecastDay = `
                                            <div class="forecast-day">
                                                <div class="forecast-date">${getDayName(day.date)}, ${formatDate(day.date)}</div>
                                                <div class="forecast-icon"><i class="${getWeatherIcon(day.weather.icon)}"></i></div>
                                                <div class="forecast-temp">
                                                    <span>${maxTemp}°C</span>
                                                    <span>${minTemp}°C</span>
                                                </div>
                                                <div class="forecast-details">
                                                    <div><i class="fas fa-tint"></i> ${avgHumidity}%</div>
                                                    <div><i class="fas fa-wind"></i> ${avgWind} m/s</div>
                                                </div>
                                            </div>
                                        `;
                                        forecastContainer.append(forecastDay);
                                    });

                                    $('#forecast-section').fadeIn();
                                },
                                error: function() {
                                    console.error('Error getting forecast data');
                                }
                            });
                        },
                        error: function() {
                            alert('Error getting weather data. Please try again later.');
                        }
                    });
                }
            });
        });

    </script>
